{% load static %}
<!DOCTYPE html>
<html lang="es" data-theme="business">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}">
        <!-- SEO Meta Tags -->
        <title>
            {% block title %}
                TodoPadel - Tu gestión de torneos
            {% endblock title %}
        </title>
        <meta name="description"
              content="{% block meta_description %}Organiza y participa en los mejores torneos de pádel. Rankings, estadísticas y gestión completa en TodoPadel.{% endblock %}">
        <meta name="keywords"
              content="{% block meta_keywords %}padel, torneos, ranking, deporte, argentina, gestión, partidos, campeonato{% endblock %}">
        <meta name="author" content="TodoPadel">
        <link rel="canonical" href="{{ request.build_absolute_uri }}">
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="{% block og_type %}website{% endblock %}">
        <meta property="og:url" content="{{ request.build_absolute_uri }}">
        <meta property="og:title"
              content="{% block og_title %}TodoPadel - Gestión de Torneos{% endblock %}">
        <meta property="og:description"
              content="{% block og_description %}La plataforma definitiva para tus torneos de pádel.{% endblock %}">
        <meta property="og:image"
              content="{% block og_image %}{% static 'img/og-image.jpg' %}{% endblock %}">
        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="{{ request.build_absolute_uri }}">
        <meta property="twitter:title"
              content="{% block twitter_title %}TodoPadel{% endblock %}">
        <meta property="twitter:description"
              content="{% block twitter_description %}Organiza y juega al pádel como un profesional.{% endblock %}">
        <meta property="twitter:image"
              content="{% block twitter_image %}{% static 'img/og-image.jpg' %}{% endblock %}">
        <!-- JSON-LD Structured Data -->
        <script type="application/ld+json">{% block structured_data %}{% endblock %}</script>
        <!-- 1. HTMX -->
        <script src="https://unpkg.com/htmx.org@1.9.10"
                xintegrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC"
                crossorigin="anonymous"></script>
        <!-- 2. DAISY UI CSS (Componentes) -->
        <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css"
              rel="stylesheet"
              type="text/css" />
        <!-- Google Fonts: Inter -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap"
              rel="stylesheet">
        <!-- 3. TAILWIND CSS JS (Utilidades de Diseño) -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Configuración para modo oscuro y tema -->
        <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#10b981', // Emerald 500
                    }
                }
            }
        }
        if (localStorage.getItem('theme') === 'corporate' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: light)').matches)) {
            document.documentElement.setAttribute('data-theme', 'corporate');
        } else {
            document.documentElement.setAttribute('data-theme', 'business');
        }
        </script>
        <!-- Estilos extra para contraste y botones -->
        <style>
        /* Forzar Verde Esmeralda como color primario en ambos temas (DaisyUI 4 Oklch) */
        :root, html[data-theme="corporate"], [data-theme="corporate"] {
            --p: 72% 0.16 163 !important; /* Primary Emerald */
            --pc: 98% 0.01 163 !important; /* Primary Content (White) */
            --su: 72% 0.16 163 !important; /* Success Emerald */
            --suc: 98% 0.01 163 !important;
        }
        
        html[data-theme="business"], [data-theme="business"] {
            --p: 72% 0.16 163 !important;
            --pc: 15% 0.02 163 !important; /* Primary Content (Dark) */
            --su: 72% 0.16 163 !important;
            --suc: 98% 0.01 163 !important;
        }

        /* Forzar colores Emerald en botones clave para evitar residuales de temas */
        .btn-primary, .btn-success {
            background-color: #10b981 !important;
            border-color: #10b981 !important;
            color: white !important;
        }
        [data-theme="business"] .btn-primary,
        [data-theme="business"] .btn-success {
            color: #1a1a1a !important;
        }
        .btn-primary:hover, .btn-success:hover {
            background-color: #059669 !important;
            border-color: #059669 !important;
        }

        /* Override corporate theme defaults for rounded corners */
        [data-theme="corporate"] {
            --rounded-box: 1rem;
            --rounded-btn: 0.5rem;
            --rounded-badge: 1.9rem;
        }

        /* Botones ghost con contraste al hover */
        .btn-ghost:hover {
            background-color: rgba(100, 100, 100, 0.1);
        }

        /* Botones primarios y secundarios con hover más visible */
        .btn-primary,
        .btn-secondary {
            transition: all 0.2s;
        }

        .btn-primary:active,
        .btn-secondary:active {
            transform: scale(0.95);
        }

        .btn-primary:hover,
        .btn-secondary:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }

        /* Tablas responsivas sin scroll horizontal forzado */
        .table-wrapper {
            width: 100%;
            overflow: auto;
        }

        /* --- Select2 Dark Mode & DaisyUI Integration --- */

        /* Contenedor principal (Input) */
        .select2-container--default .select2-selection--single {
            background-color: var(--fallback-b1, oklch(var(--b1)/1));
            border-color: var(--fallback-bc, oklch(var(--bc)/0.2));
            color: var(--fallback-bc, oklch(var(--bc)/1));
            height: 3rem !important;
            /* h-12 */
            display: flex !important;
            align-items: center !important;
            border-radius: var(--rounded-btn, 0.5rem);
        }

        /* Refinar estado activo en sidebar (Menos bloque, más indicación lateral) */
        .drawer-side .menu a.active,
        .drawer-side .menu details[open] > summary,
        .drawer-side .menu details > summary.active {
            background-color: color-mix(in oklch, var(--fallback-bc, oklch(var(--bc)/1)), transparent 90%) !important;
            color: #10b981 !important;
            border-left: 4px solid #10b981 !important;
            border-radius: 0.75rem !important;
            font-weight: 700 !important;
            box-shadow: none !important;
        }

        /* Asegurar hover en todos los botones del sidebar */
        .drawer-side .menu li a:not(.active):hover,
        .drawer-side .menu li summary:not(.active):hover {
            background-color: color-mix(in oklch, var(--fallback-bc, oklch(var(--bc)/1)), transparent 92%) !important;
            color: #10b981 !important;
            border-left: 4px solid color-mix(in oklch, #10b981, transparent 60%) !important;
        }

        /* Texto seleccionado en Select2 */
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            color: var(--fallback-bc, oklch(var(--bc)/1));
            line-height: normal !important;
            padding-left: 1rem;
        }

        /* Flecha */

        /* Ajuste para modo oscuro específico si las variables fallan */
        [data-theme="dark"] .select2-container--default .select2-selection--single {
            background-color: #1d232a;
            /* base-100 fallback */
            border-color: #383f47;
            color: #a6adbb;
        }

        [data-theme="dark"] .select2-dropdown {
            background-color: #1d232a;
            border-color: #383f47;
        }

        [data-theme="dark"] .select2-search__field {
            background-color: #191e24;
            /* base-200 */
            color: #a6adbb;
        }

        /* --- Select2 Multiple (Nuevo Widget) --- */
        .select2-container--default .select2-selection--multiple {
            background-color: var(--fallback-b1, oklch(var(--b1)/1));
            border-color: var(--fallback-bc, oklch(var(--bc)/0.2));
            color: var(--fallback-bc, oklch(var(--bc)/1));
            min-height: 3rem;
            border-radius: var(--rounded-btn, 0.5rem);
            display: flex;
            align-items: center;
            padding: 0.25rem;
        }

        /* Etiqueta seleccionada */
        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            background-color: var(--fallback-p, oklch(var(--p)/1));
            border-color: var(--fallback-p, oklch(var(--p)/1));
            color: var(--fallback-pc, oklch(var(--pc)/1));
            border-radius: 0.25rem;
            padding: 0 0.5rem;
            margin-top: 0;
        }

        /* Botón de eliminar etiqueta (x) */
        .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
            color: var(--fallback-pc, oklch(var(--pc)/0.7));
            border-right: 1px solid var(--fallback-pc, oklch(var(--pc)/0.3));
            margin-right: 0.25rem;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
            background-color: rgba(0, 0, 0, 0.1);
            color: var(--fallback-pc, oklch(var(--pc)/1));
        }

        /* Input de texto en multiple */
        .select2-container--default .select2-search--inline .select2-search__field {
            color: var(--fallback-bc, oklch(var(--bc)/1));
            margin-top: 0;
            font-family: inherit;
        }

        /* Fallback Dark Mode para Multiple */
        [data-theme="dark"] .select2-container--default .select2-selection--multiple {
            background-color: #1d232a;
            border-color: #383f47;
            color: #a6adbb;
        }

        /* --- Modern Gradient Animations --- */
        @keyframes gradient-x {
            0%, 100% {
                background-size: 200% 200%;
                background-position: left center;
            }
            50% {
                background-size: 200% 200%;
                background-position: right center;
            }
        }

        .animate-gradient-x {
            background-size: 200% auto;
            animation: gradient-x 6s ease infinite;
        }

        /* Smooth scrollbar for overflow areas */
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: oklch(var(--bc) / 0.2);
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: oklch(var(--bc) / 0.3);
        }

        /* Force 2xl:drawer-open behavior using native lg:drawer-open but overriding for tablet */
        @media (min-width: 1024px) and (max-width: 1535.98px) {
            .drawer.lg\:drawer-open > .drawer-toggle ~ .drawer-side {
                position: fixed !important;
                pointer-events: none !important;
                visibility: hidden !important;
            }
            .drawer.lg\:drawer-open > .drawer-toggle:checked ~ .drawer-side {
                pointer-events: auto !important;
                visibility: visible !important;
                opacity: 1 !important;
                transform: none !important;
            }
            .drawer.lg\:drawer-open > .drawer-toggle ~ .drawer-side > .drawer-overlay {
                cursor: pointer !important;
                visibility: visible !important;
            }
        }
        </style>
        <link rel="stylesheet" href="{% static 'css/select2-mobile.css' %}">
        {% block extra_head %}
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            {% if form.media %}{{ form.media.css }}{% endif %}
        {% endblock extra_head %}
    </head>
    <body class="min-h-screen bg-base-200 font-sans text-base-content overflow-x-hidden antialiased selection:bg-primary selection:text-white"
          hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
        <!-- Global Loader -->
        <div id="global-loader"
             class="fixed inset-0 z-[9999] bg-base-100 flex flex-col items-center justify-center transition-opacity duration-500 ease-out">
            <div class="relative w-32 h-32 animate-pulse">
                <img src="{% static 'img/logo.png' %}"
                     alt="TodoPadel"
                     class="w-full h-full object-contain drop-shadow-2xl">
            </div>
        </div>
        <div class="drawer lg:drawer-open flex-grow">
            <input id="my-drawer" type="checkbox" class="drawer-toggle" />
            <div class="drawer-content flex flex-col">
                <!-- Navbar Top -->
                <div class="navbar sticky top-0 z-40 bg-base-200/95 backdrop-blur-md shadow-sm border-b border-base-300 justify-between px-6">
                    <!-- Navbar Start (Left & Search) -->
                    <div class="navbar-start flex-1 gap-2 md:gap-4">
                        <div class="flex-none 2xl:hidden">
                            <label for="my-drawer"
                                   aria-label="open sidebar"
                                   class="btn btn-circle btn-ghost text-primary">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     class="inline-block w-6 h-6 stroke-current">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h10M4 18h16"></path>
                                </svg>
                            </label>
                        </div>
                        <!-- Brand (Mobile/Tablet < 2xl) -->
                        <a href="{% url 'core:home' %}"
                           class="btn btn-ghost btn-circle sm:btn-square normal-case text-xl 2xl:hidden">
                            <span class="w-10 h-10 flex items-center justify-center">
                                <img src="{% static 'img/logo.png' %}"
                                     alt="Logo"
                                     class="w-9 h-9 object-contain">
                            </span>
                        </a>
                        <!-- Search Bar (Desktop - Visible only on 2xl+) -->
                        <div class="hidden 2xl:flex w-full justify-center">
                            <form action="{% url 'core:search' %}" method="get" class="w-full max-w-md">
                                <div class="relative w-full">
                                    <input type="text"
                                           name="q"
                                           placeholder="Buscar torneos, jugadores..."
                                           class="input input-bordered w-full h-10 pl-10 bg-base-200/50 focus:bg-base-100 transition-colors rounded-xl text-sm" />
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 opacity-50"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- Navbar End (Right) -->
                    <div class="navbar-end w-auto flex-none gap-2">
                        <!-- Theme Toggle (Hidden on mobile) -->
                        <label class="swap swap-rotate btn btn-ghost btn-circle btn-sm hidden sm:inline-grid">
                            <input type="checkbox" class="theme-controller" value="dark" />
                            <svg class="swap-on fill-current w-5 h-5"
                                 xmlns="http://www.w3.org/2000/svg"
                                 viewBox="0 0 24 24">
                                <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,4.93l.71.71A1,1,0,0,0,5.64,7.05Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z" />
                            </svg>
                            <svg class="swap-off fill-current w-5 h-5"
                                 xmlns="http://www.w3.org/2000/svg"
                                 viewBox="0 0 24 24">
                                <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z" />
                            </svg>
                        </label>
                        {% if user.is_authenticated %}
                            <div class="dropdown dropdown-end">
                                <div tabindex="0"
                                     role="button"
                                     class="btn btn-ghost btn-circle avatar indicator {% if not user.imagen %}placeholder bg-primary text-primary-content{% endif %}">
                                    {% if notification_count > 0 %}
                                        <span class="indicator-item badge badge-error badge-xs w-2 h-2 p-0 border-none top-1 right-1"></span>
                                    {% endif %}
                                    <div class="w-9 rounded-full">
                                        {% if user.imagen %}
                                            <img src="{{ user.imagen.url }}"
                                                 alt="{{ user.nombre }}"
                                                 class="object-cover w-full h-full rounded-full" />
                                        {% else %}
                                            <span>{{ user.nombre|slice:":1"|upper }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <ul tabindex="0"
                                    class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-64 border border-base-200">
                                    <li class="menu-title opacity-50 px-4 py-2 bg-base-200/50 rounded-t-box truncate block"
                                        title="{{ user.email }}">{{ user.email }}</li>
                                    {% if pending_invitations_count > 0 %}
                                        <li>
                                            <a href="{% url 'accounts:perfil' %}"
                                               class="flex justify-between text-warning font-bold">
                                                Invitaciones
                                                <span class="badge badge-warning badge-sm">{{ pending_invitations_count }}</span>
                                            </a>
                                        </li>
                                    {% endif %}
                                    {% if upcoming_matches_count > 0 %}
                                        <li>
                                            <a href="{% url 'accounts:perfil' %}"
                                               class="flex justify-between text-info font-bold">
                                                Prox. Partidos
                                                <span class="badge badge-info badge-sm">{{ upcoming_matches_count }}</span>
                                            </a>
                                        </li>
                                    {% endif %}
                                    <li>
                                        <a href="{% url 'accounts:perfil' %}" class="py-3">
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                 class="h-5 w-5 opacity-70"
                                                 fill="none"
                                                 viewBox="0 0 24 24"
                                                 stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                            </svg>
                                            Mi Perfil
                                        </a>
                                    </li>
                                    <li class="mt-1 border-t border-base-200">
                                        <form action="{% url 'accounts:logout' %}" method="post" class="w-full p-0">
                                            {% csrf_token %}
                                            <button type="submit"
                                                    class="w-full text-left text-error font-medium py-3 px-4 hover:bg-error/10 rounded-b-box flex gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     class="h-5 w-5"
                                                     fill="none"
                                                     viewBox="0 0 24 24"
                                                     stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                                </svg>
                                                Cerrar Sesión
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                            </div>
                        {% else %}
                            <div class="flex items-center gap-2">
                                <a href="{% url 'accounts:login' %}"
                                   class="btn btn-sm btn-outline text-primary normal-case">Acceder</a>
                                <a href="{% url 'accounts:registro' %}"
                                   class="btn btn-sm btn-primary rounded-lg hidden md:inline-flex !bg-[#10b981] !border-[#10b981] hover:!bg-[#059669] !text-white shadow-sm transition-all">Registrarse</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <!-- Content Area -->
                <div class="flex flex-grow w-full max-w-[1920px]">
                    <!-- Max width container -->
                    <!-- Main Content (Left Aligned) -->
                    <main class="flex-grow p-4 md:p-6 lg:p-8 min-w-0">
                        <!-- min-w-0 prevents flex overflow -->
                        {% if messages %}
                            <div class="toast toast-top toast-center z-[100] w-full max-w-md p-4 space-y-2">
                                {% for message in messages %}
                                    <div role="alert"
                                         class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-error{% elif message.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %} shadow-lg border-none text-white animate-in slide-in-from-top-2 fade-in duration-300">
                                        <!-- Icons remain same -->
                                        <span class="text-sm font-medium">{{ message }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                        {% block content %}
                        {% endblock content %}
                    </main>
                    <!-- Right Sidebar (Placeholder for Ads - Symmetry) -->
                    <aside class="hidden 2xl:block w-80 bg-base-100 border-l border-base-200 shrink-0 p-6">
                        <!-- Placeholder Content -->
                        <div class="h-full rounded-2xl border-2 border-dashed border-base-300/50 flex flex-col items-center justify-center text-base-content/30 gap-4 p-4 text-center">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 fill="none"
                                 viewBox="0 0 24 24"
                                 stroke-width="1.5"
                                 stroke="currentColor"
                                 class="w-12 h-12 opacity-50">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="font-medium text-sm">Espacio Publicitario</span>
                        </div>
                    </aside>
                </div>
            </div>
            <!-- Sidebar -->
            <div class="drawer-side z-50">
                <label for="my-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
                <div class="menu p-4 w-80 min-h-full bg-base-100 border-r border-base-200 text-base-content flex flex-col gap-2">
                    <!-- Logo / Brand -->
                    <div class="mb-6 px-2 mt-2">
                        <a href="{% url 'core:home' %}"
                           class="flex items-center gap-1 text-2xl font-black tracking-tight hover:opacity-80 transition-opacity">
                            <span class="w-12 h-12 flex items-center justify-center">
                                <img src="{% static 'img/logo.png' %}"
                                     alt="Logo"
                                     class="w-11 h-11 object-contain">
                            </span>
                            <span class="text-base-content font-semibold opacity-70">Todo</span><span class="text-base-content font-black brightness-[1.8] dark:brightness-[2.5]">Padel</span>
                        </a>
                    </div>
                    <!-- Sidebar Navigation -->
                    <ul class="menu menu-md gap-1 font-medium">
                        <li>
                            <a href="{% url 'core:home' %}"
                               class="{% if request.resolver_match.url_name == 'home' %}active{% endif %} rounded-xl">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="h-5 w-5"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                </svg>
                                Inicio
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'torneos:en_juego_list' %}"
                               class="{% if request.resolver_match.url_name == 'en_juego_list' %}active{% endif %} rounded-xl">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="h-5 w-5"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                                En Juego
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'torneos:abierto_list' %}"
                               class="{% if request.resolver_match.url_name == 'abierto_list' %}active{% endif %} rounded-xl">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="h-5 w-5"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                                Inscripciones
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'core:search' %}"
                               class="{% if request.resolver_match.url_name == 'search' %}active{% endif %} rounded-xl 2xl:hidden">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="h-5 w-5"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                Buscar
                            </a>
                        </li>
                        {% if user.is_authenticated %}
                            <li class="menu-title mt-4 opacity-70">Tu Gestión</li>
                            {% if user.tipo_usuario == 'PLAYER' or user.tipo_usuario == 'ADMIN' %}
                                <li>
                                    <a href="{% url 'equipos:mi_equipo' %}"
                                       class="{% if request.resolver_match.url_name == 'mi_equipo' %}active{% endif %} rounded-xl">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                        </svg>
                                        Mi Equipo
                                    </a>
                                </li>
                            {% endif %}
                            <li>
                                <a href="{% url 'accounts:perfil' %}"
                                   class="{% if request.resolver_match.url_name == 'perfil' %}active{% endif %} rounded-xl">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-5 w-5"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                    Mi Perfil
                                </a>
                            </li>
                            <li>
                                <label class="flex items-center gap-4 px-4 py-3 sm:hidden cursor-pointer rounded-xl hover:bg-base-200">
                                    <div class="swap swap-rotate h-5 w-5">
                                        <input type="checkbox" class="theme-controller" value="dark" />
                                        <svg class="swap-on fill-current w-5 h-5"
                                             xmlns="http://www.w3.org/2000/svg"
                                             viewBox="0 0 24 24">
                                            <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,4.93l.71.71A1,1,0,0,0,5.64,7.05Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z" />
                                        </svg>
                                        <svg class="swap-off fill-current w-5 h-5"
                                             xmlns="http://www.w3.org/2000/svg"
                                             viewBox="0 0 24 24">
                                            <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z" />
                                        </svg>
                                    </div>
                                    <span class="theme-text font-medium">Modo Oscuro</span>
                                </label>
                            </li>
                            {% if user.tipo_usuario == 'ADMIN' or user.tipo_usuario == 'ORGANIZER' %}
                                <li>
                                    <details {% if 'equipos/admin' in request.path or 'torneos/admin' in request.path %}open{% endif %}>
                                        <summary class="{% if 'equipos/admin' in request.path or 'torneos/admin' in request.path %}active{% endif %} rounded-xl">
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                 class="h-5 w-5"
                                                 fill="none"
                                                 viewBox="0 0 24 24"
                                                 stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            </svg>
                                            Administración
                                        </summary>
                                        <ul>
                                            <li>
                                                <a href="{% url 'equipos:admin_list' %}"
                                                   class="{% if request.resolver_match.url_name == 'admin_list' and 'equipos' in request.path %}active{% endif %} rounded-xl">Equipos</a>
                                            </li>
                                            <li>
                                                <a href="{% url 'torneos:admin_list' %}"
                                                   class="{% if request.resolver_match.url_name == 'admin_list' and 'torneos' in request.path %}active{% endif %} rounded-xl">Listar Torneos</a>
                                            </li>
                                            <li>
                                                <a href="{% url 'torneos:admin_crear' %}"
                                                   class="{% if request.resolver_match.url_name == 'admin_crear' %}active{% endif %} rounded-xl">Crear Torneo</a>
                                            </li>
                                        </ul>
                                    </details>
                                </li>
                            {% endif %}
                        {% endif %}
                        <li class="menu-title mt-4 opacity-70">Competición</li>
                        <li>
                            <a href="{% url 'torneos:finalizado_list' %}"
                               class="{% if request.resolver_match.url_name == 'finalizado_list' %}active{% endif %} rounded-xl">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="h-5 w-5"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Historial
                            </a>
                        </li>
                        <li>
                            <details {% if 'rankings' in request.path %}open{% endif %}>
                                <summary class="{% if 'rankings' in request.path %}active{% endif %} rounded-xl">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-5 w-5"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                    </svg>
                                    Rankings
                                </summary>
                                <ul>
                                    <li>
                                        <a href="{% url 'accounts:rankings_jugadores' %}"
                                           class="{% if request.resolver_match.url_name == 'rankings_jugadores' %}active{% endif %} rounded-xl">Jugadores</a>
                                    </li>
                                    <li>
                                        <a href="{% url 'equipos:rankings' %}"
                                           class="{% if request.resolver_match.url_name == 'rankings' %}active{% endif %} rounded-xl">Equipos</a>
                                    </li>
                                </ul>
                            </details>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- Footer (Full Width, below Sidebar) -->
        <footer class="footer footer-center p-4 bg-base-200/50 text-base-content/60 mt-auto text-sm border-t border-base-200">
            <aside>
                <p class="font-medium">TodoPadel © {% now "Y" %}</p>
            </aside>
        </footer>
        {% block extra_js %}
            {% if form.media %}{{ form.media.js }}{% endif %}
        {% endblock extra_js %}
        <script>
        const themeControllers = document.querySelectorAll('.theme-controller');
        const themeTexts = document.querySelectorAll('.theme-text');
        const currentTheme = document.documentElement.getAttribute('data-theme');
        
        // Helper to update text
        const updateThemeText = (theme) => {
            const text = theme === 'business' ? 'Modo Claro' : 'Modo Oscuro';
            themeTexts.forEach(el => el.textContent = text);
        };

        // Initialize all controllers
        themeControllers.forEach(controller => {
            if (currentTheme === 'business') { 
                controller.checked = true; 
                updateThemeText('business');
            } else {
                updateThemeText('corporate');
            }
            
            controller.addEventListener('change', (e) => {
                const newTheme = e.target.checked ? 'business' : 'corporate';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeText(newTheme);
                
                // Sync other controllers
                themeControllers.forEach(c => {
                    c.checked = e.target.checked;
                });
            });
        });

        // Auto-dismiss alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', () => {
            const alerts = document.querySelectorAll('.toast .alert');
            alerts.forEach(alert => {
                // Add fade-out animation after 5 seconds
                setTimeout(() => {
                    alert.style.transition = 'opacity 0.5s ease-out';
                    alert.style.opacity = '0';
                    // Remove from DOM after animation completes
                    setTimeout(() => {
                        alert.remove();
                    }, 500);
                }, 3000);
            });
        });
        </script>
        <!-- Global Scripts -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
             // Close details (Administration menu) when clicking outside
             document.addEventListener('click', function(event) {
                const openDetails = document.querySelectorAll('details[open]');
                openDetails.forEach(detail => {
                    if (!detail.contains(event.target)) {
                        detail.removeAttribute('open');
                    }
                });

                // Close dropdowns (User Profile) when clicking outside
                // DaisyUI dropdowns open on focus, so we blur the active element if it's inside a dropdown
                const dropdowns = document.querySelectorAll('.dropdown');
                dropdowns.forEach(dropdown => {
                    if (!dropdown.contains(event.target)) {
                         const activeElement = document.activeElement;
                         if (dropdown.contains(activeElement)) {
                             activeElement.blur();
                         }
                    }
                });
             });
        });
        </script>
        <!-- Loader Logic -->
        <script>
        document.addEventListener("DOMContentLoaded", function () {
             // Create a minimum timeout to ensure the logo is seen
            setTimeout(function() {
                const loader = document.getElementById('global-loader');
                if (loader) {
                    loader.classList.add('opacity-0', 'pointer-events-none');
                    // Optional: remove from DOM after transition
                    setTimeout(() => loader.remove(), 500);
                }
            }, 800); // 800ms minimum display time
        });
        </script>
    </body>
</html>
