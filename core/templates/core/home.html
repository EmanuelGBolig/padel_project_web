{% extends "base.html" %}
{% load static %}
{% block title %}
    Inicio | TodoPadel
{% endblock title %}
{% block meta_description %}
    Únete a TodoPadel, la plataforma líder para gestionar torneos de pádel amateur y profesional. Inscríbete en torneos abiertos, sigue partidos en vivo y consulta rankings actualizados.
{% endblock meta_description %}
{% block extra_head %}
{% endblock extra_head %}
{% block meta_keywords %}
    padel, torneos padel, inscripciones padel, ranking jugadores, resultados en vivo, padel amateur, gestion deportiva
{% endblock meta_keywords %}
{% block structured_data %}
    {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "TodoPadel",
    "url": "{{ request.build_absolute_uri }}",
    "logo": "{{ request.scheme }}://{{ request.get_host }}{% static 'img/logo.png' %}",
    "description": "La plataforma líder para gestión de torneos de pádel amateur y profesional.",
    "sameAs": [
    "https://www.instagram.com/todopadelArg",
    "https://www.facebook.com/todopadelArg"
    ]
    }
{% endblock structured_data %}
{% block content %}
    <div class="flex flex-col gap-12">
        <!-- Hero -->
        <!-- Hero -->
        <div class="text-center py-12 bg-base-100 rounded-3xl border border-base-300 shadow-sm transition-all duration-300">
            <div class="max-w-3xl mx-auto">
                <h1 class="text-5xl md:text-6xl font-black text-base-content mb-6 tracking-tight">
                    Torneos de <span class="text-primary brightness-110">Pádel</span>
                </h1>
                <p class="text-xl md:text-2xl text-base-content/80 font-medium mb-8 leading-relaxed">
                    Gestiona tus equipos, inscríbete y sigue los resultados en tiempo real.
                </p>
                {% if user.is_authenticated and user.tipo_usuario == 'ADMIN' %}
                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <a href="{% url 'torneos:admin_crear' %}"
                           class="btn btn-primary btn-lg shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 gap-3">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 fill="none"
                                 viewBox="0 0 24 24"
                                 stroke-width="2"
                                 stroke="currentColor"
                                 class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                            </svg>
                            Crear Nuevo Torneo
                        </a>
                        <a href="{% url 'torneos:admin_list' %}"
                           class="btn btn-outline btn-lg hover:bg-base-200 gap-3">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 fill="none"
                                 viewBox="0 0 24 24"
                                 stroke-width="2"
                                 stroke="currentColor"
                                 class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
                            </svg>
                            Administrar
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- Torneos Abiertos -->
        {% if torneos_abiertos %}
            <section class="bg-base-100 p-6 md:p-8 rounded-3xl border border-base-300 shadow-sm overflow-hidden">
                <div class="flex items-center gap-4 mb-6 md:mb-8">
                    <div class="w-12 h-12 rounded-2xl bg-success/10 flex items-center justify-center text-success shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="24"
                             height="24"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke-width="2"
                             stroke="currentColor"
                             class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-base-content">Inscripciones Abiertas</h2>
                        <p class="text-sm text-base-content/80">Únete a los próximos torneos disponibles</p>
                    </div>
                </div>
                <!-- Carousel Container -->
                <!-- Wrapper for Arrows -->
                <div class="relative group">
                    <!-- Prev Button -->
                    <button class="absolute left-0 top-1/2 -translate-y-1/2 -ml-4 z-10 flex items-center justify-center w-8 h-8 md:w-12 md:h-12 rounded-full cursor-pointer bg-base-100/80 hover:bg-base-100 text-base-content backdrop-blur-sm shadow-sm border border-base-200 opacity-0 group-hover:opacity-100 transition-opacity hidden md:flex"
                            id="prev-abiertos">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             class="h-6 w-6"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <!-- Carousel Container -->
                    <div id="carousel-abiertos"
                         class="flex overflow-x-auto snap-x snap-mandatory gap-4 pb-4 md:gap-6 hide-scrollbar relative scroll-smooth">
                        {% for torneo in torneos_abiertos %}
                            <div class="carousel-item w-[85%] shrink-0 md:w-[calc((100%-48px)/3)] snap-center h-full transition-transform duration-300">
                                <div class="card bg-base-200/50 dark:bg-base-100 shadow hover:shadow-xl transition-all duration-300 border border-base-content/5 h-full hover:-translate-y-1 w-full">
                                    <div class="card-body p-4 md:p-6 flex flex-col h-full">
                                        <div class="flex justify-between items-start mb-2 md:mb-4">
                                            <h3 class="card-title text-lg md:text-xl font-bold line-clamp-2 min-h-[3rem] md:min-h-[3.5rem]">
                                                {{ torneo.nombre }}
                                            </h3>
                                            <div class="badge badge-success gap-1 text-white font-medium shrink-0">Abierto</div>
                                        </div>
                                        <div class="flex flex-wrap gap-2 mb-3 md:mb-6">
                                            <div class="badge badge-outline border-base-content/20">{{ torneo.division.nombre }}</div>
                                            {% if torneo.pk in torneos_inscritos_ids %}<div class="badge badge-info text-white">Inscrito</div>{% endif %}
                                        </div>
                                        <div class="space-y-2 md:space-y-3 text-sm text-base-content/70 mt-auto mb-3 md:mb-6">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     fill="none"
                                                     viewBox="0 0 24 24"
                                                     stroke-width="1.5"
                                                     stroke="currentColor"
                                                     class="w-5 h-5 opacity-70">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                                                </svg>
                                                <span>Inicio: <span class="font-medium text-base-content">{{ torneo.fecha_inicio|date:"d M Y" }}</span></span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     fill="none"
                                                     viewBox="0 0 24 24"
                                                     stroke-width="1.5"
                                                     stroke="currentColor"
                                                     class="w-5 h-5 opacity-70">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z" />
                                                </svg>
                                                <span>Cupos: <span class="font-medium text-base-content">{{ torneo.inscripciones.count }} / {{ torneo.cupos_totales }}</span></span>
                                            </div>
                                        </div>
                                        <div class="card-actions">
                                            {% if not user.is_staff %}
                                                {% if torneo.pk in torneos_inscritos_ids %}
                                                    <a href="{% url 'torneos:detail' torneo.pk %}"
                                                       class="btn btn-info text-white w-full shadow-sm hover:shadow">Ver Detalles</a>
                                                {% else %}
                                                    <a href="{% url 'torneos:detail' torneo.pk %}"
                                                       class="btn btn-success text-white w-full shadow-sm hover:shadow">Ver e Inscribirse</a>
                                                {% endif %}
                                            {% endif %}
                                            {% if user.is_staff %}
                                                <a href="{% url 'torneos:admin_manage' torneo.pk %}"
                                                   class="btn btn-outline btn-sm w-full">Gestionar</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <!-- Next Button -->
                    <button class="absolute right-0 top-1/2 -translate-y-1/2 -mr-4 z-10 flex items-center justify-center w-8 h-8 md:w-12 md:h-12 rounded-full cursor-pointer bg-base-100/80 hover:bg-base-100 text-base-content backdrop-blur-sm shadow-sm border border-base-200 opacity-0 group-hover:opacity-100 transition-opacity hidden md:flex"
                            id="next-abiertos">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             class="h-6 w-6"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
                <!-- Dots Indicator -->
                <div id="dots-abiertos" class="flex justify-center gap-2 mt-2 md:hidden"></div>
            </section>
        {% endif %}
        <!-- Torneos en Juego -->
        {% if torneos_en_juego %}
            <section class="bg-base-100 p-6 md:p-8 rounded-3xl border border-base-300 shadow-sm overflow-hidden">
                <div class="flex items-center gap-4 mb-6 md:mb-8">
                    <div class="w-12 h-12 rounded-2xl bg-info/10 flex items-center justify-center text-info shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="24"
                             height="24"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke-width="2"
                             stroke="currentColor"
                             class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 0 1-.982-3.172M9.497 14.25a7.454 7.454 0 0 0 .981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 0 0 7.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.492a46.32 46.32 0 012.916.52 6.003 6.003 0 01-5.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0a6.772 6.772 0 01-3.044 0" />
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-base-content">Jugando Ahora</h2>
                        <p class="text-sm text-base-content/80">Sigue los resultados y clasificaciones en vivo</p>
                    </div>
                </div>
                <!-- Carousel Container -->
                <!-- Wrapper for Arrows -->
                <div class="relative group">
                    <!-- Prev Button -->
                    <button class="absolute left-0 top-1/2 -translate-y-1/2 -ml-4 z-10 flex items-center justify-center w-8 h-8 md:w-12 md:h-12 rounded-full cursor-pointer bg-base-100/80 hover:bg-base-100 text-base-content backdrop-blur-sm shadow-sm border border-base-200 opacity-0 group-hover:opacity-100 transition-opacity hidden md:flex"
                            id="prev-juego">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             class="h-6 w-6"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <!-- Carousel Container -->
                    <div id="carousel-juego"
                         class="flex overflow-x-auto snap-x snap-mandatory gap-4 pb-4 md:gap-6 hide-scrollbar relative scroll-smooth">
                        {% for torneo in torneos_en_juego %}
                            <div class="carousel-item w-[85%] md:w-[calc((100%-48px)/3)] shrink-0 snap-center h-full transition-transform duration-300">
                                <div class="card bg-base-100 shadow hover:shadow-xl transition-all duration-300 border border-base-content/5 h-full hover:-translate-y-1 w-full">
                                    <div class="card-body p-4 md:p-6 flex flex-col h-full">
                                        <div class="flex justify-between items-start mb-2 md:mb-4">
                                            <h3 class="card-title text-lg md:text-xl font-bold line-clamp-2 min-h-[3rem] md:min-h-[3.5rem]">
                                                {{ torneo.nombre }}
                                            </h3>
                                            <div class="badge badge-info gap-1 text-white font-medium shrink-0">En Juego</div>
                                        </div>
                                        <div class="flex flex-wrap gap-2 mt-auto mb-4 md:mb-8">
                                            <div class="badge badge-outline border-base-content/20">{{ torneo.division.nombre }}</div>
                                            {% if torneo.pk in torneos_inscritos_ids %}<div class="badge badge-success text-white">Jugando</div>{% endif %}
                                        </div>
                                        <div class="card-actions mt-auto">
                                            <a href="{% url 'torneos:detail' torneo.pk %}"
                                               class="btn btn-outline btn-info w-full hover:shadow">
                                                Ver Brackets y Resultados
                                            </a>
                                            {% if user.is_staff %}
                                                <a href="{% url 'torneos:admin_manage' torneo.pk %}"
                                                   class="btn btn-sm btn-ghost w-full">Cargar Resultados</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <!-- Next Button -->
                    <button class="absolute right-0 top-1/2 -translate-y-1/2 -mr-4 z-10 flex items-center justify-center w-8 h-8 md:w-12 md:h-12 rounded-full cursor-pointer bg-base-100/80 hover:bg-base-100 text-base-content backdrop-blur-sm shadow-sm border border-base-200 opacity-0 group-hover:opacity-100 transition-opacity hidden md:flex"
                            id="next-juego">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             class="h-6 w-6"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
                <!-- Dots Indicator -->
                <div id="dots-juego" class="flex justify-center gap-2 mt-2 md:hidden"></div>
            </section>
        {% endif %}
        <!-- Estado Vacío -->
        {% if not torneos_abiertos and not torneos_en_juego %}
            <div class="bg-base-100 rounded-3xl border border-base-300 shadow-sm py-8">
                {% include "partials/empty_state.html" with title="¡Vaya! La cancha está vacía" message="No hay torneos activos o en inscripción en este momento. ¡Vuelve pronto para el próximo saque!" action_url="/torneos/" action_text="Ver histórico de torneos" %}
            </div>
        {% endif %}
    </div>
{% endblock content %}
{% block extra_js %}
    <!-- Carousel Logic -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const carousels = [
            { id: 'carousel-abiertos', dotsId: 'dots-abiertos', prevId: 'prev-abiertos', nextId: 'next-abiertos' },
            { id: 'carousel-juego', dotsId: 'dots-juego', prevId: 'prev-juego', nextId: 'next-juego' }
        ];

        carousels.forEach(config => {
            const container = document.getElementById(config.id);
            const dotsContainer = document.getElementById(config.dotsId);
            const prevBtn = document.getElementById(config.prevId);
            const nextBtn = document.getElementById(config.nextId);
            
            if (!container || !dotsContainer) return;

            const items = Array.from(container.children);
            if (items.length <= 1) return; 

            // Helper to get scroll ammount
            const getScrollAmount = () => {
                const itemWidth = items[0].offsetWidth;
                const isDesktop = window.innerWidth >= 768;
                const gap = isDesktop ? 24 : 16;
                return itemWidth + gap;
            };

            // Arrows Logic
            if (prevBtn && nextBtn) {
                prevBtn.addEventListener('click', () => {
                    container.scrollBy({ left: -getScrollAmount(), behavior: 'smooth' });
                });
                nextBtn.addEventListener('click', () => {
                    container.scrollBy({ left: getScrollAmount(), behavior: 'smooth' });
                });
            } 

            // 1. Generate Dots
            items.forEach((_, index) => {
                const dot = document.createElement('button');
                dot.className = `w-2 h-2 rounded-full transition-all duration-300 ${index === 0 ? 'bg-primary w-4' : 'bg-base-300'}`;
                dot.ariaLabel = `Ir a torneo ${index + 1}`;
                dot.addEventListener('click', () => {
                    const itemWidth = items[0].offsetWidth;
                    const isDesktop = window.innerWidth >= 768;
                    const gap = isDesktop ? 24 : 16;
                    const clonesCount = 3; // We will clone 3 items
                    
                    // Calculate position: (Index + ClonesCount) * (Width + Gap)
                    container.scrollTo({ left: (index + clonesCount) * (itemWidth + gap), behavior: 'smooth' }); 
                });
                dotsContainer.appendChild(dot);
            });

            const dots = Array.from(dotsContainer.children);

            // 2. Clone Items for Infinite Loop (Triple Clone for Desktop safety)
            // Fix: Only clone if we have 3 or more items to avoid confusing duplication
            const clonesCount = items.length < 3 ? 0 : 3;

            if (clonesCount > 0) {
                // Ensure we have enough items to clone, if not, repeat list
                const itemsToCloneStart = items.slice(0, clonesCount);
                const itemsToCloneEnd = items.slice(-clonesCount);
                
                // Create clones for END (append to end) -> copies of start items
                itemsToCloneStart.forEach(item => {
                    const clone = item.cloneNode(true);
                    clone.dataset.clone = 'end-copy'; 
                    container.appendChild(clone);
                });

                // Create clones for START (prepend to start) -> copies of end items
                // We reverse to keep order when prepending one by one
                itemsToCloneEnd.reverse().forEach(item => {
                    const clone = item.cloneNode(true);
                    clone.dataset.clone = 'start-copy';
                    container.insertBefore(clone, container.firstChild);
                });
            } else {
                // For small lists, hide desktop arrows if content fits
                // 3 items fit on desktop (100% / 3). So 1 or 2 items definitely fit.
                if (window.innerWidth >= 768) {
                    if (prevBtn) prevBtn.style.display = 'none';
                    if (nextBtn) nextBtn.style.display = 'none';
                }
            }

            // 3. Initial Scroll Position (Skip the start clones)
            const updateScrollPos = () => {
                const itemWidth = items[0].offsetWidth; 
                const isDesktop = window.innerWidth >= 768;
                const gap = isDesktop ? 24 : 16;
                container.scrollLeft = clonesCount * (itemWidth + gap);
            };

            // Wait for layout
            requestAnimationFrame(updateScrollPos);
            
            // Also update on resize to keep alignment
            window.addEventListener('resize', () => {
                // Optional: Debounce this or just reset to a valid item
                if (clonesCount === 0 && window.innerWidth >= 768) {
                     if (prevBtn) prevBtn.style.display = 'none';
                     if (nextBtn) nextBtn.style.display = 'none';
                }
            });

            // 4. Infinite Scroll Logic
            container.addEventListener('scroll', () => {
                const itemWidth = items[0].offsetWidth;
                const isDesktop = window.innerWidth >= 768;
                const gap = isDesktop ? 24 : 16;
                
                const cardSpace = itemWidth + gap;
                const totalRealWidth = items.length * cardSpace;
                
                const scrollLeft = container.scrollLeft;
                
                if (clonesCount > 0) {
                    // Thresholds
                    // If we are showing the first clone (which is a copy of the last real item) at the start
                    // The start clones take up: clonesCount * cardSpace
                    // Real items start at: clonesCount * cardSpace
                    
                    // If scroll is near 0 (showing start clones - copies of end)
                    if (scrollLeft <= 10) {
                        // Jump forward to real last items
                        container.scrollLeft = totalRealWidth + scrollLeft;
                    }
                    // If scroll is near end (showing end clones - copies of start)
                    // End of real items is at: (clonesCount * cardSpace) + totalRealWidth
                    else if (scrollLeft >= (clonesCount * cardSpace) + totalRealWidth - 10) {
                         // Jump back to real start
                         container.scrollLeft = scrollLeft - totalRealWidth;
                    }
                }

                // 5. Update Dots Active State
                // Identify the center item index
                // Center of viewport
                const centerPos = scrollLeft + (container.clientWidth / 2);
                // Adjust for start clones offset
                const relativePos = centerPos - (clonesCount * cardSpace);
                
                let activeIndex = Math.floor(relativePos / cardSpace);
                
                // Wrap index safely
                if (activeIndex < 0) activeIndex = (activeIndex % items.length + items.length) % items.length;
                if (activeIndex >= items.length) activeIndex = activeIndex % items.length;

                dots.forEach((dot, index) => {
                    if (index === activeIndex) {
                        dot.classList.remove('bg-base-300', 'w-2');
                        dot.classList.add('bg-primary', 'w-4');
                    } else {
                        dot.classList.remove('bg-primary', 'w-4');
                        dot.classList.add('bg-base-300', 'w-2');
                    }
                });
            });
        });
    });
    </script>
{% endblock extra_js %}
