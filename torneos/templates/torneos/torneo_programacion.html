{% extends 'base.html' %}
{% load static %}
{% block head_title %}Programación - {{ torneo.nombre }}{% endblock %}
{% block content %}
    <div class="container mx-auto px-4 py-8 max-w-4xl" data-theme="business">
        <!-- HEADER -->
        <div class="mb-8">
            <h1 class="text-3xl font-black text-white tracking-wider uppercase mb-1 drop-shadow-md">PROGRAMACIÓN</h1>
            <h2 class="text-xl font-bold text-base-content/70 uppercase tracking-widest">{{ torneo.nombre }}</h2>
        </div>
        <!-- FECHAS (LISTA AGRUPADA) -->
        <div class="space-y-12 pb-12">
            {% regroup partidos_con_fecha by fecha_hora|date:"Y-m-d H:i" as partidos_por_hora %}
            {% for agrupacion in partidos_por_hora %}
                <div class="space-y-4">
                    <!-- SEPARADOR DE FECHA/HORA -->
                    <div class="flex items-center justify-center relative my-6">
                        <!-- Línea horizontal de fondo verde muy sutil -->
                        <div class="absolute inset-x-0 h-px bg-emerald-500/20"></div>
                        <!-- Badge central -->
                        <div class="relative z-10 flex text-sm font-bold shadow-lg overflow-hidden">
                            <div class="bg-emerald-500 text-base-100 px-3 py-1 flex items-center justify-center leading-none">
                                {{ agrupacion.grouper|slice:"11:16" }} <!-- Extraer solo hora Ej: 09:00 -->
                            </div>
                            <div class="bg-white text-base-100 px-4 py-1 flex items-center justify-center leading-none">
                                {{ agrupacion.list.0.fecha_hora|date:"d/m/Y" }}
                            </div>
                        </div>
                    </div>
                    <!-- PARTIDOS DE ESA HORA -->
                    <div class="grid gap-3">
                        {% for partido in agrupacion.list %}
                            <div class="bg-[#1a1e23] border border-emerald-500/10 rounded-xl p-4 md:p-6 flex flex-col md:flex-row items-center justify-between shadow-[0_4px_20px_-5px_rgba(0,0,0,0.5)] transition-all hover:bg-[#1d232a] hover:border-emerald-500/30">
                                <!-- Equipo 1 -->
                                <div class="flex-1 text-center md:text-left w-full space-y-1 mb-4 md:mb-0">
                                    {% if partido.equipo1 %}
                                        <p class="text-[1.1rem] md:text-lg text-base-content font-medium opacity-90 truncate">
                                            {{ partido.equipo1.jugador1.full_name|default:"-" }}
                                        </p>
                                        <p class="text-[1.1rem] md:text-lg text-white font-bold truncate">
                                            {{ partido.equipo1.jugador2.full_name|default:"-" }}
                                        </p>
                                    {% else %}
                                        <p class="text-[1.1rem] md:text-lg text-base-content/50 font-medium italic select-none">
                                            {{ partido.placeholder_e1|default:"Por definir" }}
                                        </p>
                                        <p class="text-[1.1rem] md:text-lg text-base-content/50 font-medium italic select-none">-</p>
                                    {% endif %}
                                </div>
                                <!-- VS Centro -->
                                <div class="flex flex-col items-center justify-center shrink-0 px-4 w-full md:w-auto mb-4 md:mb-0">
                                    <span class="text-xs tracking-[0.2em] text-base-content/60 font-semibold uppercase mb-1">{{ torneo.division.nombre|default:"Libre" }} {{ partido.obj.get_categoria_display|default:torneo.get_categoria_display }}</span>
                                    <div class="text-2xl md:text-3xl font-black text-white px-2 tracking-widest drop-shadow-md">VS</div>
                                    <span class="text-xs text-base-content/60 font-medium mt-1 uppercase">{{ partido.fase }} - {{ partido.descripcion_partido }}</span>
                                </div>
                                <!-- Equipo 2 -->
                                <div class="flex-1 text-center md:text-right w-full space-y-1">
                                    {% if partido.equipo2 %}
                                        <p class="text-[1.1rem] md:text-lg text-base-content font-medium opacity-90 truncate">
                                            {{ partido.equipo2.jugador1.full_name|default:"-" }}
                                        </p>
                                        <p class="text-[1.1rem] md:text-lg text-white font-bold truncate">
                                            {{ partido.equipo2.jugador2.full_name|default:"-" }}
                                        </p>
                                    {% else %}
                                        <p class="text-[1.1rem] md:text-lg text-base-content/50 font-medium italic select-none">
                                            {{ partido.placeholder_e2|default:"Por definir" }}
                                        </p>
                                        <p class="text-[1.1rem] md:text-lg text-base-content/50 font-medium italic select-none">-</p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% empty %}
                <div class="text-center py-10 opacity-70">
                    <p>Aún no hay partidos con fecha y hora programada.</p>
                </div>
            {% endfor %}
            <!-- PARTIDOS POR DEFINIR (SIN FECHA) -->
            {% if partidos_sin_fecha %}
                <div class="space-y-4 pt-10">
                    <!-- SEPARADOR POR DEFINIR -->
                    <div class="flex items-center justify-center relative my-6">
                        <!-- Línea horizontal de fondo naranja muy sutil -->
                        <div class="absolute inset-x-0 h-px bg-warning/20"></div>
                        <!-- Badge central -->
                        <div class="relative z-10 flex text-sm font-bold shadow-lg overflow-hidden">
                            <div class="bg-warning text-warning-content px-5 py-1 flex items-center justify-center leading-none uppercase tracking-wider">
                                Por definir
                            </div>
                        </div>
                    </div>
                    <!-- PARTIDOS SIN ESTABLECER HORA -->
                    <div class="grid gap-3 opacity-80">
                        {% for partido in partidos_sin_fecha %}
                            <div class="bg-[#1a1e23]/80 border border-base-content/5 rounded-xl p-4 md:p-6 flex flex-col md:flex-row items-center justify-between shadow-sm transition-all hover:bg-[#1d232a] hover:border-base-content/10">
                                <!-- Equipo 1 -->
                                <div class="flex-1 text-center md:text-left w-full space-y-1 mb-4 md:mb-0">
                                    {% if partido.equipo1 %}
                                        <p class="text-[1.1rem] md:text-lg text-base-content font-medium opacity-80 truncate">
                                            {{ partido.equipo1.jugador1.full_name|default:"-" }}
                                        </p>
                                        <p class="text-[1.1rem] md:text-lg text-white font-bold truncate">
                                            {{ partido.equipo1.jugador2.full_name|default:"-" }}
                                        </p>
                                    {% else %}
                                        <p class="text-[1.1rem] md:text-lg text-base-content/40 font-medium italic select-none">
                                            {{ partido.placeholder_e1|default:"Por definir" }}
                                        </p>
                                    {% endif %}
                                </div>
                                <!-- VS Centro -->
                                <div class="flex flex-col items-center justify-center shrink-0 px-4 w-full md:w-auto mb-4 md:mb-0">
                                    <span class="text-xs tracking-[0.2em] text-base-content/50 font-semibold uppercase mb-1">{{ torneo.division.nombre|default:"Libre" }} {{ partido.obj.get_categoria_display|default:torneo.get_categoria_display }}</span>
                                    <div class="text-2xl md:text-3xl font-black text-white/50 px-2 tracking-widest">VS</div>
                                    <span class="text-xs text-base-content/50 font-medium mt-1 uppercase">{{ partido.fase }} - {{ partido.descripcion_partido }}</span>
                                </div>
                                <!-- Equipo 2 -->
                                <div class="flex-1 text-center md:text-right w-full space-y-1">
                                    {% if partido.equipo2 %}
                                        <p class="text-[1.1rem] md:text-lg text-base-content font-medium opacity-80 truncate">
                                            {{ partido.equipo2.jugador1.full_name|default:"-" }}
                                        </p>
                                        <p class="text-[1.1rem] md:text-lg text-white font-bold truncate">
                                            {{ partido.equipo2.jugador2.full_name|default:"-" }}
                                        </p>
                                    {% else %}
                                        <p class="text-[1.1rem] md:text-lg text-base-content/40 font-medium italic select-none">
                                            {{ partido.placeholder_e2|default:"Por definir" }}
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock content %}
